var G=Object.defineProperty;var J=(t,u,o)=>u in t?G(t,u,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[u]=o;var S=(t,u,o)=>(J(t,typeof u!="symbol"?u+"":u,o),o);import{M as K,F as X,D as Z,I as ee,N as ae}from"./element-plus.49c70961.js";import{i as te}from"./is.84ee87a3.js";import{l as le,r as p,w as q,e as oe,j as ne,T as re,c as N,Y as I,S as R,P as F,u as T,o as g,F as O,a7 as H,R as E,L as se,U,al as z,V as Q,a2 as W,aa as ue,d as de}from"./@vue.8279fe1a.js";import{c as k,h as P}from"./index.8eaf2094.js";import{u as ce}from"./vue-i18n.9b911f69.js";const ye=le({__name:"CForm",props:{options:{default:()=>[]},gutter:{default:24},colSpan:null,value:{default:{}},loading:{type:Boolean,default:!1}},emits:["submit","update:value"],setup(t,{expose:u,emit:o}){const h=t,c={input:"el-input",select:"el-select",inputNumber:"el-input-number",timePicker:"el-time-picker",datePicker:"el-date-picker",richText:"WangEditor"},C=["el-input","el-input-number","async-select"],f=p(),V=p({}),D=p([]),d=p({}),B=l=>l.map(n=>{let{name:y,type:_,tagName:i,...m}=n;return c[_]&&!i&&(i=c[_]),{...m,name:y,tagName:i}});q(()=>h.options,l=>{const n={};D.value=l.map(y=>{let{name:_,type:i,children:m,rules:e,tagName:b,...a}=y;return e&&(n[_]=e),i&&c[i]&&!b&&(b=c[i]),m&&te(m)&&(m=B(m)),{...a,name:_,tagName:b,children:m}}),V.value=n},{immediate:!0});const v=oe(()=>{const l=h.options&&h.options.length>10?{md:12,xs:24}:{span:24};return h.colSpan||l});async function L(){var l;await((l=f.value)==null?void 0:l.validate(n=>{if(n){const y=h.value;o("submit",y)}}))}function M(...l){var n;(n=f.value)==null||n.validateField(...l)}function $(...l){var n;(n=f.value)==null||n.validate(...l)}function A(...l){var n;(n=f.value)==null||n.resetFields(...l)}function x(...l){var n;(n=f.value)==null||n.clearValidate(...l)}return u({validateField:M,validate:$,resetFields:A,clearValidate:x,submit:L}),q(()=>h.value,l=>{d.value=l},{immediate:!0}),ne(()=>{o("update:value",d.value)}),(l,n)=>{const y=K,_=X,i=Z,m=ee;return re((g(),N("div",null,[I(T(ae),F({ref_key:"formRef",ref:f,rules:V.value,model:t.value},l.$attrs),{default:R(()=>[I(i,{gutter:t.gutter},{default:R(()=>[(g(!0),N(O,null,H(D.value,(e,b)=>(g(),N(O,{key:b},[e.hidden?Q("",!0):(g(),E(_,F({key:0},e.colSpan||T(v),{key:e.name}),{default:R(()=>[I(y,F({prop:e.name,label:e.label},e.itemExtra),{default:R(()=>{var a,s,w;return[e.scopedSlot&&l.$slots[e.scopedSlot]?se(l.$slots,e.scopedSlot,{key:0,value:t.value,option:e}):e.tagName?(g(),N(O,{key:1},[C.includes(e.tagName)?(g(),E(U(e.tagName),F({key:0,modelValue:d.value[e.name],"onUpdate:modelValue":r=>d.value[e.name]=r,modelModifiers:{trim:!0}},e.props,z((a=e.on)!=null?a:{})),null,16,["modelValue","onUpdate:modelValue"])):e.children?(g(),E(U(e.tagName),F({key:1,modelValue:d.value[e.name],"onUpdate:modelValue":r=>d.value[e.name]=r,modelModifiers:{trim:!0}},e.props,z((s=e.on)!=null?s:{})),{default:R(()=>[(g(!0),N(O,null,H(e.children,(r,Y)=>{var j;return g(),E(U(r.tagName),F({key:Y},r.props,z((j=r.on)!=null?j:{})),null,16)}),128))]),_:2},1040,["modelValue","onUpdate:modelValue"])):(g(),E(U(e.tagName),F({key:2,modelValue:d.value[e.name],"onUpdate:modelValue":r=>d.value[e.name]=r},e.props,z((w=e.on)!=null?w:{})),null,16,["modelValue","onUpdate:modelValue"]))],64)):Q("",!0)]}),_:2},1040,["prop","label"])]),_:2},1040))],64))),128))]),_:3},8,["gutter"])]),_:3},16,["rules","model"])])),[[m,t.loading]])}}});class ie{constructor(u){S(this,"dataSource",p([]));S(this,"loading",p(!1));S(this,"ids",p([]));S(this,"queryParam",p());S(this,"url",p({}));S(this,"modalFormRef",p());S(this,"drawerFormRef",p());S(this,"ipagination",W({current:1,total:0,pageSize:10,pageSizeOptions:[5,10,20,50,100]}));this.url.value=u}}function _e(t){const u=new ie(t),{t:o}=ce(),{dataSource:h,ipagination:c,loading:C,queryParam:f,ids:V,modalFormRef:D,drawerFormRef:d}=ue(W(u)),B=()=>({page:c.value.current,pageSize:c.value.pageSize,...f.value}),v=async(a=!1)=>{if(!t.list){k("error",o("page.common.notice.set_url_list"));return}a&&(c.value.current=1);const s=B();try{C.value=!0;const w=await P.get(t.list,s);h.value=w.data.data,c.value.total=Number(w.data.total)}finally{C.value=!1}},L=()=>{D.value.edit({}),D.value.title=o("page.common.title.add")},M=a=>{f.value=a,v(!0)},$=()=>{f.value={},v(!0)},A=(a,s=o("page.common.title.edit"))=>{D.value.edit(a),D.value.title=s},x=async a=>new Promise(async(s,w)=>{try{if(!t.add){k("error",o("page.common.notice.set_url_add"));return}const r=await P.post(t.add,{data:a});r.code===200&&r.data&&s(r)}catch(r){w(r)}}),l=async a=>new Promise(async(s,w)=>{try{if(!t.edit){k("error",o("page.common.notice.set_url_edit"));return}const r=await P.put(t.edit,{data:a});r.code===200&&r.data&&s(r)}catch(r){w(r)}}),n=async a=>{if(!t.delete){k("error",o("page.common.notice.set_url_delete"));return}const s=await P.delete(`${t.delete}/${a}`);s.code===200&&s.data&&(k("success",o("page.common.notice.delete_success")),v(!0))},y=async()=>{if(!t.batchDelete){k("error",o("page.common.notice.set_url_batchDelete"));return}if(V.value.length===0){k("error",o("page.common.notice.empty_delete_data"));return}const a=await P.batchDelete(t.batchDelete,{data:V.value});a.code===200&&a.data&&(k("success",o("page.common.notice.batchDelete_success")),v(!0))},_=()=>{d.value.add(),d.value.title=o("page.common.title.add")},i=(a,s=o("page.common.title.edit"))=>{d.value.edit(a),d.value.title=s},m=a=>{c.value.pageSize=a,v()},e=a=>{c.value.current=a,v()},b=a=>{V.value=T(a).map(s=>s.id)};return de(async()=>{await v(!0)}),{loadData:v,handleOpenAddDialog:L,handleOpenEditDialog:A,handleReset:$,handleAdd:x,handleEdit:l,handleDelete:n,handleBatchDelete:y,handleSearch:M,handleOpenAddDialogDrawer:_,handleOpenEditDialogDrawer:i,handleSizeChange:m,handleCurrentChange:e,handleSelectionChange:b,dataSource:h,ids:V,ipagination:c,modalFormRef:D,loading:C}}export{ye as _,_e as u};
